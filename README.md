[![Release](https://img.shields.io/badge/dynamic/json?color=blue&label=Release&query=tag_name&url=https%5B%5D)](https:%5B%5D)
![License](https://img.shields.io/github/license/LexusWang/Aurora-demos)

# Aurora-demos

This project contains the attack chains generated by Aurora, a cyberattack emulation system leveraging classical planning (PDDL) and Large Language Models (LLMs).

Aurora is a framework that can automatically construct multi-step cyberattacks (attack chains), set up emulation environments, and semi-automatically execute the generated attack chains. With the help of LLM, it makes use of external attack tools and threat intelligence reports.

We are preparing publishing the source code of Aurora.

## üéâ Introduction

<p><a href="https://arxiv.org/pdf/2407.16928"><img src="images/First_page.png" alt="Paper thumbnail" align="right" width="160"/></a></p>

-   Introduces AURORA, an cyberattack emulation system leveraging classical planning (PDDL) and Large Language Models (LLMs).
-   Automates construction of a 5,000+ action attack space with over 1,000 chains.
-   AURORA generates higher quality attack plans with broader TTP coverage.

Our paper: [From Sands to Mansions: Towards Automated Cyberattack Emulation with Classical Planning and Large Language Models](https://arxiv.org/pdf/2407.16928)

## Resources & Socials

-   üìú [Documentation, training, and use-cases]()(Coming Soon)
-   ‚úçÔ∏è [aurora's blog]()(Coming Soon)
-   üåê [Homepage](https://auroraattack.github.io/)

## System Overview

<p align="center">

<img src="images/framework.png" alt="cli output" width="1000"/>

</p>

Aurora‚Äôs architecture comprises five components:
- `Attack Tool Analysis`: Converts third-party tool documentation into structured attack actions using rule-based and LLM-assisted predicate extraction.
- `Attack Report Analysis`: Extracts Tactics, Techniques, and Procedures (TTPs) from CTI reports via LLMs to guide attack planning.
- `Attack Planning`: Uses PDDL and reward functions (aligned with CTI-derived TTPs) to generate attack chains.
- `Attack Environment Builder`: Deploys pre-configured virtual machines to replicate vulnerable environments.
- `Attack Execution`: Semi-automatically runs attack scripts and collects traces for dataset construction.

## Attack Chains

This repo stores attack chains generated by Aurora, which can be found in the `attack_chains/` folder.
Each folder in `attack_chains/` contains an attach chain, which includes the details of the attack chain and an attack execution script (in Python).

For more details, please refer to the [introduction to attack chains](https://github.com/LexusWang/Aurora-demos/blob/main/docs/attack_chain_introduction.md).

## Execute Attack Chains
We show how to reproduce (execute) the generated attacks in this section.
Please clone this repo first:
```
git clone https://github.com/LexusWang/Aurora-demos.git && cd Aurora-demos
```

### 0. Dependencies
Viewing the generated attack chains in this repo does not require any dependencies.
To reproduce the attacks, however, you will need to install [VirtualBox](https://www.virtualbox.org/wiki/Downloads) for deploying and managing virtual machines (we use VirtualBox as the default virtualization software; VMware users can manually download and deploy the virtual machines).

Specifically, You need to know the path of the command-line interface (CLI) tool for VirtualBox (e.g. `C:\\Program Files\\Oracle\\VirtualBox\\VBoxManage.exe` or `/usr/bin/VBoxManage`).

### 1. Pull and deploy the attack emulation environments:
#### 1.A Pull and deploy the attacker machine
We first need to set up an attack machine equipped with the necessary attack tools.
Specifically, we use [Attack Executor](https://github.com/LexusWang/attack_executor) to execute the attack actions provided by different attack tools.
Detailed configuration steps are documented in [Guide](./docs/attacker_environment_setup_guide.md).

We‚Äôve also prepared pre-configured attack machine for you! You can download and deploy it directly from [here](https://drive.google.com/file/d/1FCBZtsHM363eWor1xep4CzfNtMSio-RS/view?usp=drive_link) or using this command:
```
python pull.py -p attacker -d download -vm C:\\Program Files\\Oracle\\VirtualBox\\VBoxManage.exe --url_table docs\url_table.csv -nr
```

#### 1.B Pull and deploy the victim machines
After deploying the attacker machine, we set up the victim machines.
Running `pull.py` on the attack chain YML file automatically downloads and deploys the corresponding victim machines.

``` bash
## Prohibit repeated VM downloading
python pull.py -p #yml_file_path -d #storage_path -vm #VBoxManage.exe_path --url_table #url_table_path -nr -firewall #yes/no
```
- `-p #yml_file_path`ÔºöThe path of the attack chain `.yml` file;  
- `-d #storage_path`ÔºöThe storage path of the downloaded VM file;  
- `-vm #VBoxManage.exe_path`ÔºöThe path of installed VirtualBox executable file (`VBoxManage.exe`);  
- `--url_table #url_table_path`ÔºöThe path of the Download Link mapping table (url_table.csv);
- `-nr`ÔºöProhibiting duplicate deployment;
- `-r`ÔºöAllowing duplicate downloads;
- `-firewall #yes/no`ÔºöUse pfSense firewall to isolate the attack host and the target host.  

Notes:
- Two download modes are supported:
  - No duplication (`-nr`): If the VM image file already exists, it will skip the downloading and directly proceed with deployment.
  - Allow duplications (`-r`): VM image files will be automatically redownloaded and renamed to avoid conflicts.

- During initial deployment, the VM will not start automatically, allowing users to modify configurations before first startup.

- By default, two network adapters will be configured for each VM: one in NAT mode and the other in Host-only mode. Make sure the required network is configured in VirtualBox; otherwise, the VM may fail to start.


<!-- Example:If you don't want to allow repeated downloads of the attack chain "examples\access_encrypted_edge_credentials\attack_plan.yml" corresponding to the range. You can use  -->
Example: Deploy the emulation environments of the attack chain `attack_chains\keyboard_input_simulated-3\attack_plan.yml` on Windows:
``` bash
python pull.py -p attack_chains\keyboard_input_simulated-3\attack_plan.yml -d download -vm C:\\Program Files\\Oracle\\VirtualBox\\VBoxManage.exe --url_table docs\url_table.csv -nr -firewall no
```
If the VM image file has been downloaded before, it will display:
<p align="center">

<img src="images/No_repeat.png" alt="request" width="1200"/>

</p>
Entering "yes" will directly start the corresponding virtual machine.
On the contrary, if duplication is allowed, the VM image file will be redownloaded and renamed to avoid conflicts.

<br>

<!-- ``` bash
python pull.py -p examples\access_encrypted_edge_credentials\attack_plan.yml -d download -vm C:\\Program Files\\Oracle\\VirtualBox\\VBoxManage.exe --url_table docs\url_table.csv -nr -firewall yes
``` -->
If you want to use firewall for isolation. Just set `-firewall` as `yes`. 
When using pfsense, the configuration interface is as follows:
<p align="center">

<img src="images/pfsense.png" alt="pfsense set" width="1200"/>

</p>
‚ö†Ô∏è Please note that if you want to deploy a firewall, two host-only network adapters need to be set up in VirtualBox.
Meanwhile, it is recommended to turn off the NAT network adapters (otherwise all VMs can connect directly).

<br>
In addition to building the VM from the `attack_plan.yml` files, you can also pull and deploy the VMs in this table by using the `-p` flag. 

For example:
``` bash
python pull.py -p macos -d download -vm C:\\Program Files\\Oracle\\VirtualBox\\VBoxManage.exe --url_table docs\url_table.csv -nr
```

#### Attack emulation infrastructure
Here is an example of the deployed attack emulation environments including two attacker machines and three victim machines.

<p align="center">

<img src="images/the%20emulation%20infrastructure.jpg" alt="cli output" width="1200"/>

</p>

- Attackers: Kali, Windows 10<br>
- DNS_server: Debian<br>
- Firewall: pfSense<br>
- VictimsÔºöWindows 10, MacOS, Ubuntu<br>

You can visit this [doc](https://github.com/LexusWang/Aurora-demos/blob/main/docs/Emulation_Infrastructure_info.md) to view more detailed information about the simulation environment.

### 2. Generate attack scripts:
‚è© (For now users can skip this step since we have already generated the attack execution script for each attack chain.)

Aurora provides a semi-automatic execution script in Python for each attack chain (`attack_plan.yml`).
This design simplifies user configuration and minimizes manual intervention.
The Python scripts are generated by calling `generateExecution.py`.

``` bash
python generateExecution.py
```

<p align="center">

<img src="images/generateExecution.gif" alt="editor" align="center"/>

</p>

### 3. Execute attack scripts:

We've generated attack execution scripts for every attack chain in `attack_chains`.
Once the emulation environment is deployed, simply open the terminal, run the scripts, and follow the on-screen instructions to execute the attack.

```bash
python execution_xxxx.py
```
Click the following headings for details:
<details>
<summary>EXAMPLE-1_execution_keyboard_input_simulated-3</summary>

This attack plan uses `Metasploit` and `Sliver` tools to compromise Windows systems. First, a listener is established to capture incoming connections. A malicious `Sliver` payload is then created and delivered by tricking the victim into downloading/running it, granting remote access. Finally, this access is leveraged to deploy a stealthy `Meterpreter` payload via `Sliver` for data exfiltration (`keyboard input simulation`)


![progress](images/example1.gif)

</details>

<details>
<summary>EXAMPLE-2_execution_file_info_known-1</summary>

This attack simulation targets Windows systems using `Sliver` and `Metasploit`. It starts by creating a `Sliver` implant (malicious.exe) and tricking the victim into downloading/running it as Administrator. This grants attackers an elevated `Sliver` C2 session. Next, a `Metasploit` listener is set up to catch a reverse HTTPS payload ("meterpreter_reverse_http") deployed through `Sliver`, enabling a stealthy `Meterpreter` session. Finally, attackers use `Meterpreter` to search for sensitive files (like *.txt) on compromised machines.


![progress](images/example2.gif)
</details>

## Licensing
Distributed under the MIT License. See `LICENSE.txt` for more information. The attack chains are for education, research, and testing purpose.
The author does not condone any illegal use.
Use as your own risk.

## Contact the Contributors!
- Lingzhi Wang - [lingzhiwang2025@u.northwestern.edu](lingzhiwang2025@u.northwestern.edu)
- Yi Jiang - [jiangyi99@zju.edu.cn](jiangyi99@zju.edu.cn)
- Zhengkai Wang - [wangzhengkai@zju.edu.cn](wangzhengkai@zju.edu.cn)
